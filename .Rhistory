library("phytools")
library("ape")
source("./S.PhyloMaker-master/R_codes for S.PhyloMaker") #phylogeny tools
leaf <- read.csv(".\\raw data\\leaf_traits.csv", stringsAsFactors = FALSE)
wood <- read.csv(".\\raw data\\twig_traits.csv", stringsAsFactors = FALSE)
field <- read.csv(".\\raw data\\field_data.csv", stringsAsFactors = FALSE)
sp_info <- read.csv(".\\raw data\\lista_spp_plantas_edited_sf100818.csv", stringsAsFactors=FALSE)
plot_data <- read.csv("./raw data/30_parcelas_arvores_2015_complet_out_2015_sf_edits.csv", stringsAsFactors = FALSE)
charlight <- read.csv("./raw data/CharLight_final_102218.csv")
frost <- read.csv("./raw data/FrostDamageAll.csv")
max_heights <- read.csv("./raw data/species_max_heights.csv")
#------------------------------------------------------------------------------
# Clean up trait data
#------------------------------------------------------------------------------
leaf_reduced <- leaf[!(leaf$Individual %in% c("Omit", "omit")), c("Individual", "Leaflet.or.leaf.size..mm2.", "Total.leaf.size..mm2.",
"Leaf.thickness.1..mm.", "Leaf.thickness.2..mm.", "Leaf.thickness.3..mm.", "SLA..cm2.g.1.")]
leaf_reduced$Leaf.thickness.1..mm. <- as.numeric(leaf_reduced$Leaf.thickness.1..mm.)
leaf_reduced$Leaf.thickness.2..mm. <- as.numeric(leaf_reduced$Leaf.thickness.2..mm.)
leaf_reduced$Leaf.thickness.3..mm. <- as.numeric(leaf_reduced$Leaf.thickness.3..mm.)
# leaf_reduced[leaf_reduced$SLA..cm2.g.1. == "#VALUE", "SLA..cm2.g.1."] <- NA
# leaf_reduced[leaf_reduced$SLA..cm2.g.1. == 0, "SLA..cm2.g.1."] <- NA
leaf_reduced$SLA..cm2.g.1. <- as.numeric(leaf_reduced$SLA..cm2.g.1.)
wood_reduced <- wood[!(wood$Individual %in% c("Omit", "omit")), c("Individual", "Outer.diameter", "Twig.bark.thickness", "Relative.bark.thickness", "Density..g.mL.")]
field_reduced <- field[!(field$Individual %in% c("Omit", "omit")), c("Individual", "X", "Code", "D30", "DBH", "Ht", "Lower.leaf", "Bark1", "Bark2", "Bark3", "Light")]
names(field_reduced)[2] <- "Bonus"
#get max DBH and max D30
#split diams at comma, then take the maximum
field_reduced$max_d30 <- vapply(strsplit(field_reduced$D30, split = ","),
1, FUN = function(x){return(as.numeric(max(unlist(x))))})
field_reduced$max_DBH <- vapply(strsplit(field_reduced$DBH, split = ","),
1, FUN = function(x){return(as.numeric(max(unlist(x))))})
field_reduced$D30_eff <- vapply(strsplit(field_reduced$D30, split = ","),
1, FUN = function(x){return(sqrt(sum(((as.numeric(unlist(x)))^2), na.rm = TRUE)))})
#Change some codes for synonymous species
sp_info[sp_info$Species == "Campomanesia guaviroba", "Code"] <- "CAGU2"
sp_info[sp_info$Species == "Chromolaena maximilianii", "Code"] <- "CHMA2"
sp_info[sp_info$Species == "Myrcia tomentosa" & sp_info$FG == "S", "Code"] <- "MYTO_S" #MYTO has two entries, changing this makes it a generalist
sp_info[sp_info$Species == "Ocotea puberula", "Code"] <- "OCPU2"
sp_info[sp_info$Species == "Ocotea velutina", "Code"] <- "OCVE2"
sp_info$Life.Form <- as.factor(tolower(sp_info$Life.Form))
#is there a more elegant way to do this than joinjoinjoinjoin?
clean_data <- join(join(join(join(field_reduced, leaf_reduced, by = c("Individual"), type = "left"),
wood_reduced, by = c("Individual"), type = "left"),
sp_info, by = c("Code"), type = "left"),
max_heights[, c(2,3)], by = c("Code"), type = "left")
#### Adding/calculating some variables
clean_data$Mean.Leaf.thickness <- NA
clean_data$Mean.Bark.thickness <- NA
clean_data$Crown.ratio <- NA
clean_data$Taper <- NA
clean_data$Inner.diam <- NA
clean_data$Stem.rel.bark.thick <- NA
for(i in 1:nrow(clean_data)){ #why is this all in a for loop?
clean_data$Mean.Leaf.thickness[i] <- mean(unlist(clean_data[i, c("Leaf.thickness.1..mm.", "Leaf.thickness.2..mm.", "Leaf.thickness.3..mm.")]), na.rm=TRUE)
clean_data$Mean.Bark.thickness[i] <- mean(unlist(clean_data[i, c("Bark1", "Bark2", "Bark3")]), na.rm=TRUE)
clean_data$Crown.ratio[i] <- (clean_data$Ht[i] - clean_data$Lower.leaf[i]) / clean_data$Ht[i]
clean_data$Taper[i] <- clean_data$Ht[i] / clean_data$max_d30[i]
clean_data$Inner.diam[i] <- clean_data$max_d30[i] - clean_data$Mean.Bark.thickness[i]/5
clean_data$Stem.rel.bark.thick[i] <- (clean_data$Mean.Bark.thickness[i]/5)/ clean_data$max_d30[i]
}
clean_data$Ht <- clean_data$Ht/100
#Write data
write.csv(clean_data, ".\\clean data\\clean_data.csv")
clean_data
View(clean_data)
sum(!is.na(clean_data$Mean.Leaf.thickness))
#------------------------------------------------------------------------------
# Clean up plot data
#------------------------------------------------------------------------------
plot_data <- plot_data[, !(colnames(plot_data) %in% c("X", "X.1", "X.2", "X.3", "X.4"))]
#fix some special characters in diameter data
plot_data$D30 <- gsub("=", "", plot_data$D30)
plot_data$D30 <- gsub("\\(", "", plot_data$D30)
plot_data$D30 <- gsub("\\)", "", plot_data$D30)
plot_data$DBH <- gsub("=", "", plot_data$DBH)
plot_data$DBH <- gsub("\\(", "", plot_data$DBH)
plot_data$DBH <- gsub("\\)", "", plot_data$DBH)
plot_data_no_equals <- plot_data[plot_data$Species != "=", ]
#clean up weird data entry
for(i in 1:nrow(plot_data_no_equals)){
tree_number <- plot_data_no_equals[i, "Number"]
if(length(plot_data[plot_data$Number == tree_number, "Number"])>1){ #for those tree with  more than one entry
plot_data_no_equals[i, "DBH"] <- paste(plot_data[plot_data$Number == tree_number, "DBH"], collapse = "+") #add other entry to DBH
if(length(plot_data[plot_data$Number == tree_number, "D30"])>0){ # do the same for D30
which_d30 <- sapply(plot_data[plot_data$Number == tree_number, "D30"], FUN = function(x){x!=""})
plot_data_no_equals[i, "D30"] <- paste(plot_data[plot_data$Number == tree_number, "D30"][which_d30], collapse = "+")
}
}
}
#convert species name to a 4-letter code
plot_data_no_equals$Code <- as.character(sapply(plot_data_no_equals$Species, FUN = function(x){toupper(paste(substr(unlist(strsplit(x , split = " ")), 1, 2), collapse = ""))}))
#Clean up codes and some other issues
plot_data_no_equals[plot_data_no_equals$Species == "Campomanesia guaviroba", "Code"] <- "CAGU2"
plot_data_no_equals[plot_data_no_equals$Species == "Chromolaena maximilianii", "Code"] <- "CHMA2"
plot_data_no_equals[plot_data_no_equals$Species == "Ocotea puberula", "Code"] <- "OCPU2"
plot_data_no_equals[plot_data_no_equals$Species == "Ocotea velutina", "Code"] <- "OCVE2"
plot_data_no_equals[plot_data_no_equals$Species == "Diospyros hispida", "Code"] <- "DIBU"
plot_data_no_equals[plot_data_no_equals$Species == "Lippia sidoides", "Code"] <- "LISA" #use same values for LISA and LISI
#fix some mis-entered data
plot_data_no_equals[plot_data_no_equals$Number == 4237, "Ht"] <- 5.5
plot_data_no_equals[plot_data_no_equals$Number == 4393, "Ht"] <- 1.9
plot_data_no_equals[plot_data_no_equals$Number == 4319, "Ht"] <- 1.8
plot_data_no_equals[plot_data_no_equals$Number == 1996, "Ht"] <- 4.5
plot_data_no_equals[plot_data_no_equals$Number == 4413, "DBH"] <- 19.3
plot_data_no_equals[plot_data_no_equals$Number == 4204, "DBH"] <- 13.3
plot_data_no_equals[plot_data_no_equals$Number == 4462, "DBH"] <- 14.4
plot_data_no_equals[plot_data_no_equals$Number == 5761, "DBH"] <- 7.8
plot_data_no_equals[plot_data_no_equals$Number == 2275, "DBH"] <- 7.4
plot_data_no_equals[plot_data_no_equals$Number == 3302, "DBH"] <- 7.2
plot_data_no_equals[plot_data_no_equals$Number == 7166, "DBH"] <- 5.8
plot_data_no_equals[plot_data_no_equals$Number == 4204, "DBH"] <- 13.3
plot_data_no_equals[plot_data_no_equals$Number == 4413, "DBH"] <- 19.3
plot_data_no_equals[plot_data_no_equals$Number == 4462, "DBH"] <- 11.4
plot_data_no_equals[plot_data_no_equals$Number == 5289, "DBH"] <- paste("13+11.1")
plot_data_no_equals[plot_data_no_equals$Number == 4477, "DBH"] <- 1.8
plot_data_no_equals[plot_data_no_equals$Number == 1809, "DBH"] <- 1.3
plot_data_no_equals[plot_data_no_equals$Number == 4672, "DBH"] <- 1.1
plot_data_no_equals[plot_data_no_equals$Number == 5156, "DBH"] <- paste("2+1.5")
plot_data_no_equals[plot_data_no_equals$Number == 5467, "DBH"] <- paste("19+2.2")
plot_data_no_equals[plot_data_no_equals$Number == 2398, "DBH"] <- paste("2.4+1.3+1.2")
plot_data_no_equals[plot_data_no_equals$Number == 1601, "DBH"] <- paste("1.9+1.4+1.4")
plot_data_no_equals[plot_data_no_equals$Number == 7003, "DBH"] <- paste("1.2+1.3+1.1")
plot_data_no_equals[plot_data_no_equals$Number == 2250, "DBH"] <- paste("1.1+1.1+1.5")
plot_data_no_equals[plot_data_no_equals$Number == 7010, "DBH"] <- 11.3
plot_data_no_equals[plot_data_no_equals$Number == 5378, "DBH"] <- paste("6.9+6.3")
plot_data_no_equals[plot_data_no_equals$Number == 5378, "DBH"] <- paste("2.2+2.0+2.3+1.9+3+2.2")
plot_data_no_equals[plot_data_no_equals$Number == 3577, "D30"] <- 8.6
plot_data_no_equals[plot_data_no_equals$Number == 1162, "D30"] <- 8.5
plot_data_no_equals[plot_data_no_equals$Number == 5777, "D30"] <- 7.3
plot_data_no_equals[plot_data_no_equals$Number == 4488, "D30"] <- 7.1
plot_data_no_equals[plot_data_no_equals$Number == 3469, "D30"] <- 4.7
plot_data_no_equals[plot_data_no_equals$Number == 5269, "D30"] <- 4.5
plot_data_no_equals[plot_data_no_equals$Number == 2879, "D30"] <- 4.3
plot_data_no_equals[plot_data_no_equals$Number == 4999, "D30"] <- NA
plot_data_no_equals[plot_data_no_equals$Number == 3453, "D30"] <- 12
plot_data_no_equals[plot_data_no_equals$Number == 979, "D30"] <- 24
plot_data_no_equals[plot_data_no_equals$Number == 2071, "D30"] <- NA
plot_data_no_equals[plot_data_no_equals$Number == 5309, "D30"] <- 2.3
plot_data_no_equals[plot_data_no_equals$Number == 3496, "D30"] <- 1.6
#calculate max diameters and cross-sectional areas for all trees; replace NaNs and Infs with NA
#don't worry about the errors
plot_data_no_equals$Max_DBH <- as.numeric(sapply(plot_data_no_equals$DBH, FUN = function(x){max(as.numeric(unlist(strsplit(x, split = "+",
fixed = TRUE, perl = FALSE, useBytes = FALSE))))}))
plot_data_no_equals$Max_DBH <- ifelse(!is.finite(plot_data_no_equals$Max_DBH), NA, plot_data_no_equals$Max_DBH)
plot_data_no_equals$Max_D30 <- as.numeric(sapply(plot_data_no_equals$D30, FUN = function(x){max(as.numeric(unlist(strsplit(x, split = "+",
fixed = TRUE, perl = FALSE, useBytes = FALSE))))}))
plot_data_no_equals$Max_D30 <- ifelse(!is.finite(plot_data_no_equals$Max_D30), NA, plot_data_no_equals$Max_D30)
plot_data_no_equals$CSA_BH <- as.numeric(sapply(plot_data_no_equals$DBH, FUN = function(x){sum((((as.numeric(unlist(strsplit(x, split = "+",
fixed = TRUE, perl = FALSE, useBytes = FALSE))))/2)^2)*3.14159)}))
plot_data_no_equals$CSA_BH <- ifelse(!is.finite(plot_data_no_equals$CSA_BH), NA, plot_data_no_equals$CSA_BH)
plot_data_no_equals$CSA_30 <- as.numeric(sapply(plot_data_no_equals$D30, FUN = function(x){sum((((as.numeric(unlist(strsplit(x, split = "+",
fixed = TRUE, perl = FALSE, useBytes = FALSE))))/2)^2)*3.14159)}))
plot_data_no_equals$CSA_30 <- ifelse(!is.finite(plot_data_no_equals$CSA_30), NA, plot_data_no_equals$CSA_30)
plot_data_no_equals$Density_expand <- ifelse(!is.na(plot_data_no_equals$Max_D30),
ifelse(plot_data_no_equals$Max_D30 > 5, 1, 4), ifelse(plot_data_no_equals$Max_DBH > 5, 1, 4))
plot_data_no_equals$CSA_30_expand <- plot_data_no_equals$CSA_30 * plot_data_no_equals$Density_expand
plot_data_no_equals$CSA_BH_expand <- plot_data_no_equals$CSA_BH * plot_data_no_equals$Density_expand
plot_data_no_equals$DBH_eff <- sqrt(plot_data_no_equals$CSA_BH/pi)
plot_data_no_equals$D30_eff <- sqrt(plot_data_no_equals$CSA_30/pi)
plot_data_no_equals <- join(plot_data_no_equals, sp_info[, c(2:4)], by = c("Code"), type = "left")
write.csv(plot_data_no_equals, paste0("./Clean data/plot_data", Sys.Date(), ".csv"))
#------------------------------------------------------------------------------
#Doing some bark data manipulation
#------------------------------------------------------------------------------
## Get relative bark thickness for stems
bark_table <- clean_data[, c("Code", "max_d30", "Mean.Bark.thickness")]
## Get relative bark thickness for twigs
bark_table_2 <- clean_data[, c("Code", "Outer.diameter", "Twig.bark.thickness")]
bark_table_2$Outer.diameter <- bark_table_2$Outer.diameter / 10
names(bark_table_2) <- names(bark_table)[1:3]
bark_table <- rbind(bark_table, bark_table_2) #combine all bark measurements into one data frame
bark_table$Code <- as.factor(bark_table$Code)
bark_model_global  <- lmer(Mean.Bark.thickness ~  Code*log(max_d30) + (1|Code), data = bark_table)
saveRDS(bark_model_global, "./clean data/bark_model.RDS")
bark_table_fg <- join(bark_table, clean_data[, c("Code", "FG", "Life.Form")], by = c("Code"))
bark_model_fg <- lm(Mean.Bark.thickness ~  FG*Life.Form*log(max_d30), data = bark_table_fg)
saveRDS(bark_model_global, "./clean data/bark_model_fg.RDS")
#-------------------------------------------------------------------------
# Spruce up frost and light data
#-------------------------------------------------------------------------
frost_temp <- frost[, c("placa", "light")]
names(frost_temp)[1] <- "N."
frost_temp$"N." <- as.character(frost_temp$"N.")
frost_temp <- frost_temp[complete.cases(frost_temp), ]
frost_temp <- frost_temp[ frost_temp$"N." != "", ]
#fix one row
frost_temp[frost_temp$N. == 5566, "light"] <- 2
charlight <- join(charlight, frost_temp, by = c("N."), type = "full")
#move data from frost light to charlight for those where charlight is missing light
charlight[is.na(charlight$Light.code), "Light.code"] <- charlight[is.na(charlight$Light.code), "light"]
frost$placa <- as.character(frost$placa)
charlight$"N." <- as.character(charlight$"N.")
charlight_temp <- charlight[charlight$"N." != "" & !(is.na(charlight$"N.")), ]
names(charlight_temp)[5] <- "placa"
charlight_temp <- charlight_temp[, c("placa", "Light.code")]
# frost_new <- join(frost, charlight_temp, by = c("placa"), type = "left")
# write.csv(frost_new, paste0("./clean data/FrostDamageMerged", Sys.Date(), ".csv"))
charlight$Code <- as.character(sapply(as.character(charlight$Especie), FUN = function(x){toupper(paste(substr(unlist(strsplit(x , split = " ")), 1, 2), collapse = ""))}))
charlight[charlight$Code == "DIHI", "Code"] <- "DIBU"
names(charlight)[5] <- "Number"
plot_data_no_equals <- join(plot_data_no_equals, charlight[, c("Number", "Light.code", "Char.height")], by = c("Number"), type = "left" )
write.csv(plot_data_no_equals, paste0("./Clean data/plot_data", Sys.Date(), ".csv"))
#------------------------------------------------------------------------
# Create species-level data
#------------------------------------------------------------------------
#initialize species-level dataframe
clean_species <- data.frame(Code = unique(clean_data$Code),
N = numeric(length(unique(clean_data$Code))),
Leaf_size = numeric(length(unique(clean_data$Code))),
Total_leaf_size = numeric(length(unique(clean_data$Code))),
Leaf_thickness = numeric(length(unique(clean_data$Code))),
Max_height = numeric(length(unique(clean_data$Code))),
Height_at_5cm = numeric(length(unique(clean_data$Code))),
Crown_ratio = numeric(length(unique(clean_data$Code))),
Light_at_5cm = numeric(length(unique(clean_data$Code))),
SLA = numeric(length(unique(clean_data$Code))),
Bark_at_5cm = numeric(length(unique(clean_data$Code))),
Bark_at_8mm = numeric(length(unique(clean_data$Code))),
#Leaf_N = numeric(length(unique(clean_data$Code))),
Wood_density = numeric(length(unique(clean_data$Code))),
FG = character(length(unique(clean_data$Code))),
Habit = character(length(unique(clean_data$Code))),
stringsAsFactors = FALSE
)
i <- 9
for(i in 1:length(unique(clean_data$Code))){
code_select <- unique(clean_data$Code)[i]
data_select <- clean_data[clean_data$Code == code_select, ]
clean_species$N[i] <- nrow(data_select)#length(which(complete.cases(data_select)))
clean_species$Leaf_size[i] <- mean(data_select$Leaflet.or.leaf.size..mm2., na.rm = TRUE)
clean_species$Total_leaf_size[i] <- mean(data_select$Total.leaf.size..mm2., na.rm = TRUE)
clean_species$Leaf_thickness[i] <- mean(data_select$Mean.Leaf.thickness, na.rm = TRUE)
clean_species$SLA[i] <-mean(data_select$SLA..cm2.g.1., na.rm = TRUE)
clean_species$Wood_density[i] <- mean(data_select$Density..g.mL., na.rm = TRUE)
#create regressions for predicting bark thicknesses
if(nrow(data_select) >=3){
if(sum(!is.na(data_select$Twig.bark.thickness))>3){
twig_model  <- lm(Twig.bark.thickness ~ log(Outer.diameter), data = data_select)
}
clean_species$Bark_at_8mm[i] <- predict(twig_model, newdata = list(Outer.diameter = 8))
} else{
clean_species$Bark_at_8mm[i] <- NA
}
#Height at 5cm
# use data from both plots and field measurements
ht_subset <- subset(plot_data_no_equals, Code == code_select)[, c("Ht", "D30_eff")]
ht_subset <- rbind(ht_subset, data_select[, c("Ht", "D30_eff")])
ht_subset <- ht_subset[ht_subset$D30_eff > 0 & !(is.na(ht_subset$D30_eff)) & !(is.na(ht_subset$Ht)), ]
if(nrow(ht_subset) >= 5 &
min(ht_subset$D30_eff, na.rm = TRUE) < 6 &
max(ht_subset$D30_eff, na.rm = TRUE) >4){
clean_species$Bark_at_5cm[i] <- predict(bark_model_global, newdata = list(max_d30 = 5, Code = code_select))
height_model <- lm(Ht ~ log(D30_eff), data = ht_subset)
clean_species$Height_at_5cm[i] <- predict(height_model, newdata = list(D30_eff = 5))
} else{clean_species$Height_at_5cm[i] <- NA}
#Crown ratio at 5cm
if(nrow(data_select) >= 3){
clean_species$Crown_ratio[i] <- mean(data_select$Crown.ratio, na.rm = TRUE)
} else{clean_species$Crown_ratio[i] <- NA}
#FG
clean_species$FG[i] <- as.character(data_select$FG[1])
#Light at 5cm
#don't worry about the warnings -- it returns NAs at the end anyway like it should
light_subset <- subset(plot_data_no_equals, Code == code_select)[, c("Light.code", "D30_eff")]
light_select <- data_select[, c("Light", "D30_eff")]; names(light_select)[1] <- c("Light.code")
light_subset <- rbind(light_subset, light_select)
light_subset <- light_subset[light_subset$D30_eff > 0 & !(is.na(light_subset$D30_eff)) & !(is.na(light_subset$Light.code)), ]
# print(paste(i, ": ", nrow(light_subset)))
if(nrow(light_subset) >= 5 &
min(light_subset$D30_eff, na.rm = TRUE) < 6 &
max(light_subset$D30_eff, na.rm = TRUE) >4){
light_model <- lm(Light.code ~ log(D30_eff), data = light_subset)
clean_species$Light_at_5cm[i] <- predict(light_model, newdata = list(D30_eff = 5))
} else{ clean_species$Light_at_5cm[i] <- NA}
#Habit
clean_species$Habit[i] <- as.character(data_select$Life.Form[1])
clean_species$Max_height[i] <- as.numeric(data_select$Max.height[1])
}
write.csv(clean_species, paste0("./clean data/clean_species", Sys.Date(), ".csv"))
sum(!is.na(clean_data$Mean.Bark.thickness))
sum(!is.na(clean_data$Twig.bark.thickness))
sum(!is.na(clean_species$Height_at_5cm))
sum(!is.na(plot_data_no_equals$Ht))
sum(!is.na(clean_data$Crown.ratio))
sum(!is.na(clean_species$Crown_ratio))
sum(!is.na(clean_data$SLA..cm2.g.1.))
sum(!is.na(clean_data$Density..g.mL.))
sum(!is.na(clean_species$Wood_density))
sum(!is.na(plot_data_no_equals$Light.code))
sum(!is.na(clean_species$Light_at_5cm))
nrow(clean_species[clean_species$N >= 5, ])
plot(clean_species$Bark_at_5cm ~ clean_species$Bark_at_8mm)
head(plot_data_no_equals)
View(plot_data_no_equals)
nrow(plot_data_no_equals[plot_data_no_equals$Density_expand == 1, ])
nrow(plot_data_no_equals[plot_data_no_equals$Density_expand == 4, ])
length(unique(plot_data_no_equals$Species))
plot(clean_species$Wood_density ~ clean_species$SLA)
cor.test(~Wood_density + SLA, data = clean_species)
cor.test(~Wood_density + SLA, data = clean_species_reduced)
clean_species[clean_species$Wood_density < 0.5 & clean_species$SLA > 120, ]
hist(clean_species_rediced_orig$Leaf_size)
#read data
clean_species <- read.csv("./clean data/clean_species2018-11-07.csv")
spList_orig <- read.csv("./raw data/lista_spp_plantas_families_sf_101618.csv")[-c(113, 130, 138, 176), ]
spList_orig$Sp_name <- paste(spList_orig$Genus, " ", spList_orig$Species)
plot_data <- read.csv("./Clean data/plot_data2018-11-07.csv")
bark_model_fg <- readRDS("./clean data/bark_model_fg.RDS")
clean_species$FG <- factor(clean_species$FG,levels(clean_species$FG)[c(3,2,1)])
bark_model <- readRDS("./clean data/bark_model.RDS")
clean_species$Leaf_size <- clean_species$Leaf_size/100
plot_data <- subset(plot_data, !is.na(CSA_30))
clean_species$Total_leaf_size <- clean_species$Total_leaf_size/100
clean_species_reduced <- clean_species[complete.cases(clean_species), ]
clean_species_reduced <- clean_species_reduced[clean_species_reduced$Habit %in% c("Tree", "tree", "Treelet", "treelet"), ]
clean_species_reduced_orig <- clean_species_reduced
clean_species_reduced_trans <- clean_species_reduced
hist(clean_species_reduced$Leaf_size)
hist(log(clean_species_reduced$Leaf_size))
hist(sqrt(clean_species_reduced$Leaf_size))
hist(clean_species_reduced$SLA)
hist(log(clean_species_reduced$SLA))
names(clean_species_reduced_orig)
# Bring in phylogeny
tree <- readRDS("phylogeny_code.RDS")
tree_pruned <- drop.tip(tree, setdiff(tree$tip.label, clean_species$Code))
# load libraries
library("ggplot2")
library("vegan")
library("plyr")
library("multcomp")
library("multcompView")
library("effects")
library("plotrix")
library("ape")
library("cluster")
library("FD")
library("phytools")
library("Hotelling")
setwd("C:\\Users\\Sam\\Google Drive\\Projects\\Savanna traits")
set.seed(45750762)
tree_pruned_plot <- tree_pruned
tree_pruned_plot$tip.label <- as.character(spList_orig[, "Sp_name"][match(tree_pruned$tip.label, spList_orig$Code)])
sp_codes <- tree_pruned$tip.label
fg <- spList_orig[match(sp_codes, spList_orig$Code), "FG"]
fg <- fg[!is.na(fg)]
color_groups <- data.frame(group = as.character(c("F", "G", "S")),
col = as.character(c("black", "green", "dark orange")))
color_points <- as.character(color_groups[match(fg, color_groups$group), "col"])
plot(tree_pruned_plot, type = "fan",
show.tip.label = TRUE,
tip.color = color_points)
legend(x = par()$usr[1], y = par()$usr[4],
legend = c("Forest", "Generalist", "Savanna"),
col = c("black", "green", "dark orange"),
pt.bg = c("black", "green", "dark orange"),
pch = 21,
cex = 1.3,
bty = "n")
#plot the tree
tiff(filename = "./plots/phylogeny_pruned.tiff",
width = 7,
height = 7,
units = "in",
pointsize = 8,
compression = "lzw",
res = 600)
tree_pruned_plot <- tree_pruned
tree_pruned_plot$tip.label <- as.character(spList_orig[, "Sp_name"][match(tree_pruned$tip.label, spList_orig$Code)])
sp_codes <- tree_pruned$tip.label
fg <- spList_orig[match(sp_codes, spList_orig$Code), "FG"]
fg <- fg[!is.na(fg)]
color_groups <- data.frame(group = as.character(c("F", "G", "S")),
col = as.character(c("black", "green", "dark orange")))
color_points <- as.character(color_groups[match(fg, color_groups$group), "col"])
plot(tree_pruned_plot, type = "fan",
show.tip.label = TRUE,
tip.color = color_points)
legend(x = par()$usr[1], y = par()$usr[4],
legend = c("Forest", "Generalist", "Savanna"),
col = c("black", "green", "dark orange"),
pt.bg = c("black", "green", "dark orange"),
pch = 21,
cex = 1.3,
bty = "n")
dev.off()
tree_pruned_plot <- tree_pruned
tree_pruned_plot$tip.label <- as.character(spList_orig[, "Sp_name"][match(tree_pruned$tip.label, spList_orig$Code)])
sp_codes <- tree_pruned$tip.label
fg <- spList_orig[match(sp_codes, spList_orig$Code), "FG"]
fg <- fg[!is.na(fg)]
color_groups <- data.frame(group = as.character(c("F", "G", "S")),
col = as.character(c("black", "green", "dark orange")))
color_points <- as.character(color_groups[match(fg, color_groups$group), "col"])
plot(tree_pruned_plot, type = "fan",
show.tip.label = TRUE,
tip.color = color_points)
legend(x = par()$usr[1], y = par()$usr[4],
legend = c("Forest", "Generalist", "Savanna"),
col = c("black", "green", "dark orange"),
pt.bg = c("black", "green", "dark orange"),
pch = 21,
cex = 1.3,
bty = "n")
#plot the tree
tiff(filename = "./plots/phylogeny_pruned.tiff",
width = 7,
height = 7,
units = "in",
pointsize = 8,
compression = "lzw",
res = 600)
tree_pruned_plot <- tree_pruned
tree_pruned_plot$tip.label <- as.character(spList_orig[, "Sp_name"][match(tree_pruned$tip.label, spList_orig$Code)])
sp_codes <- tree_pruned$tip.label
fg <- spList_orig[match(sp_codes, spList_orig$Code), "FG"]
fg <- fg[!is.na(fg)]
color_groups <- data.frame(group = as.character(c("F", "G", "S")),
col = as.character(c("black", "green", "dark orange")))
color_points <- as.character(color_groups[match(fg, color_groups$group), "col"])
plot(tree_pruned_plot, type = "fan",
show.tip.label = TRUE,
tip.color = color_points)
legend(x = par()$usr[1], y = par()$usr[4],
legend = c("Forest", "Generalist", "Savanna"),
col = c("black", "green", "dark orange"),
pt.bg = c("black", "green", "dark orange"),
pch = 21,
cex = 1.3,
bty = "n")
dev.off()
field_reduced
field_reduced[field_reduced$Code == "STRO", ]
clean_data
clean_data$Mean.Bark.thickness
plot(clean_data$Mean.Bark.thickness ~ clean_data$max_d30)
plot(clean_data$Mean.Bark.thickness ~ log(clean_data$max_d30))
plot(log(clean_data$Mean.Bark.thickness) ~ log(clean_data$max_d30))
sampled_ba/total_ba
sampled_plot_ba$CSA_BH_expand / plot_ba$CSA_BH_expand
#------------------------------------------------------------------------------
# What proportion of tree species sampled? For results section
#------------------------------------------------------------------------------
#calculate using both clean_species and clean_species_reduced
total_ba <- sum(plot_data$Dens_BH_expand, na.rm = TRUE)/10000
names(plot_data)
#------------------------------------------------------------------------------
# What proportion of tree species sampled? For results section
#------------------------------------------------------------------------------
#calculate using both clean_species and clean_species_reduced
total_ba <- sum(plot_data$CSA_BH_expand, na.rm = TRUE)/10000
total_ba
sampled_ba/total_ba
#read data
clean_species <- read.csv("./clean data/clean_species2018-11-07.csv")
spList_orig <- read.csv("./raw data/lista_spp_plantas_families_sf_101618.csv")[-c(113, 130, 138, 176), ]
spList_orig$Sp_name <- paste(spList_orig$Genus, " ", spList_orig$Species)
plot_data <- read.csv("./Clean data/plot_data2018-11-07.csv")
plot_data <- subset(plot_data, !is.na(CSA_30))
bark_model <- readRDS("./clean data/bark_model.RDS")
bark_model_fg <- readRDS("./clean data/bark_model_fg.RDS")
clean_species$FG <- factor(clean_species$FG,levels(clean_species$FG)[c(3,2,1)])
clean_species$Leaf_size <- clean_species$Leaf_size/100
clean_species$Total_leaf_size <- clean_species$Total_leaf_size/100
clean_species_reduced <- clean_species[complete.cases(clean_species), ]
clean_species_reduced <- clean_species_reduced[clean_species_reduced$Habit %in% c("Tree", "tree", "Treelet", "treelet"), ]
clean_species_reduced_orig <- clean_species_reduced
clean_species_reduced_trans <- clean_species_reduced
#vars to log-trans
log_trans <- c(4, 5, 6, 9, 11, 12, 13)
#log-trans predictor variables
clean_species_reduced_trans[, log_trans] <- log(clean_species_reduced_trans[, log_trans])
clean_species_reduced <- clean_species_reduced_trans
# Bring in phylogeny
tree <- readRDS("phylogeny_code.RDS")
tree_pruned <- drop.tip(tree, setdiff(tree$tip.label, clean_species$Code))
#------------------------------------------------------------------------------
# What proportion of tree species sampled? For results section
#------------------------------------------------------------------------------
#calculate using both clean_species and clean_species_reduced
total_ba <- sum(plot_data$CSA_BH_expand, na.rm = TRUE)/10000
sampled_ba <- sum(plot_data[plot_data$Code %in% clean_species$Code, ]$CSA_BH_expand, na.rm = TRUE)/10000
sampled_ba/total_ba
#------------------------------------------------------------------------------
# What proportion of tree species sampled? For results section
#------------------------------------------------------------------------------
#calculate using both clean_species and clean_species_reduced
total_ba <- sum(plot_data$Density_expand, na.rm = TRUE)/10000
sampled_ba <- sum(plot_data[plot_data$Code %in% clean_species$Code, ]$DensityBH_expand, na.rm = TRUE)/10000
sampled_ba/total_ba
plot_data$Density_expand
#------------------------------------------------------------------------------
# What proportion of tree species sampled? For results section
#------------------------------------------------------------------------------
#calculate using both clean_species and clean_species_reduced
total_ba <- sum(plot_data$Density_expand, na.rm = TRUE)
total_ ba
total_ba
sampled_ba <- sum(plot_data[plot_data$Code %in% clean_species$Code, ]$Density_expand, na.rm = TRUE)
sampled_ba/total_ba
leaf <- read.csv(".\\raw data\\leaf_traits.csv", stringsAsFactors = FALSE)
wood <- read.csv(".\\raw data\\twig_traits.csv", stringsAsFactors = FALSE)
field <- read.csv(".\\raw data\\field_data.csv", stringsAsFactors = FALSE)
unique(leaf$Species)
unique(field$Code)
sp_info <- read.csv(".\\raw data\\lista_spp_plantas_edited_sf100818.csv", stringsAsFactors=FALSE)
sp_info
cite(vioplot)
cite("vioplot")
library("vioplot")
cite("vioplot")
citation("vioplot")
