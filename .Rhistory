(1.2 * max(exp(clean_species_reduced[, traits_names[i]])))),
cex.lab = 1.3
)
}
mtext(text = levels(clean_species_reduced$FG), side = 1, at = c(1,2,3), line = 1)
mtext(text = paste0("(", letters[i], ")") , side = 3, at = 0.4, line = .3)
(tuke <- TukeyHSD(aov(model)))
pvals <- tuke$`as.factor(clean_species_reduced$FG)`[, 4]
tuke_letters <- multcompLetters(pvals, reversed=TRUE)$Letters[c(3,1,2)]
ylim <- par("usr")[c(3,4)]
yrange <- ylim[2]-ylim[1]
text(x = c(1,2,3), y = ylim[2] - yrange/10, labels = tuke_letters, cex = 1.2)
}
dev.off()
log_trans <- c(1, 2, 7, 8)
traits_names <- names(clean_species[-c(1:4, 13, 15, 16)])
traits_names_clean <- c(expression(paste("Leaf size (cm"^"2", ")")),
"Leaf thickness (mm)",
"Max height (m)",
"Height at 5 cm dia. (m)",
"       Crown ratio\nat 5cm dia. (unitless)",
"         Light code\nat 5 cm dia. (unitless)",
expression(paste("Specific leaf area (cm"^"2", " g"^"-1", ")")),
"  Bark thickness\nat 5cm dia. (mm)",
expression(paste("Wood density (g cm"^"-3",")")))
tiff(filename="./plots/traits_by_FG.tiff",
type = "cairo",
antialias = "gray",
compression = "lzw",
units="in",
width = 5,
height=7,
pointsize=9,
res=600)
par(mfrow = c(4, 3),
mar = c(2,7,2,2),
oma = c(1, 1, 0, 0))
for (i in 1:length(traits_names)){
model <- lm(clean_species_reduced[, traits_names[i]] ~ as.factor(clean_species_reduced$FG))
noise <- rnorm(nrow(clean_species_reduced), 0, .02)
if(!(i %in% log_trans)){
plot(clean_species_reduced[, traits_names[i]] ~ I(as.numeric(clean_species_reduced$FG) + noise),
xlab = "",
ylab = traits_names_clean[i],
xaxt = 'n',
xlim = c(0.8, 3.2),
ylim = c((0.8 * min(clean_species_reduced[, traits_names[i]])),
(1.2 * max(clean_species_reduced[, traits_names[i]]))),
cex.lab = 1.3
)
}else{
plot(exp(clean_species_reduced[, traits_names[i]]) ~ I(as.numeric(clean_species_reduced$FG) + noise),
xlab = "",
ylab = traits_names_clean[i],
xaxt = 'n',
xlim = c(0.8, 3.2),
ylim = c((0.8 * min(exp(clean_species_reduced[, traits_names[i]]))),
(1.2 * max(exp(clean_species_reduced[, traits_names[i]])))),
cex.lab = 1.3
)
}
mtext(text = levels(clean_species_reduced$FG), side = 1, at = c(1,2,3), line = 1)
mtext(text = paste0("(", letters[i], ")") , side = 3, at = 0.4, line = .3)
(tuke <- TukeyHSD(aov(model)))
pvals <- tuke$`as.factor(clean_species_reduced$FG)`[, 4]
tuke_letters <- multcompLetters(pvals, reversed=TRUE)$Letters[c(3,1,2)]
ylim <- par("usr")[c(3,4)]
yrange <- ylim[2]-ylim[1]
text(x = c(1,2,3), y = ylim[2] - yrange/10, labels = tuke_letters, cex = 1.2)
}
dev.off()
log_trans <- c(1, 2, 5, 7, 8)
traits_names <- names(clean_species[-c(1:4, 13, 15, 16)])
traits_names_clean <- c(expression(paste("Leaf size (cm"^"2", ")")),
"Leaf thickness (mm)",
"Max height (m)",
"Height at 5 cm dia. (m)",
"       Crown ratio\nat 5cm dia. (unitless)",
"         Light code\nat 5 cm dia. (unitless)",
expression(paste("Specific leaf area (cm"^"2", " g"^"-1", ")")),
"  Bark thickness\nat 5cm dia. (mm)",
expression(paste("Wood density (g cm"^"-3",")")))
tiff(filename="./plots/traits_by_FG.tiff",
type = "cairo",
antialias = "gray",
compression = "lzw",
units="in",
width = 5,
height=7,
pointsize=9,
res=600)
par(mfrow = c(4, 3),
mar = c(2,7,2,2),
oma = c(1, 1, 0, 0))
for (i in 1:length(traits_names)){
model <- lm(clean_species_reduced[, traits_names[i]] ~ as.factor(clean_species_reduced$FG))
noise <- rnorm(nrow(clean_species_reduced), 0, .02)
if(!(i %in% log_trans)){
plot(clean_species_reduced[, traits_names[i]] ~ I(as.numeric(clean_species_reduced$FG) + noise),
xlab = "",
ylab = traits_names_clean[i],
xaxt = 'n',
xlim = c(0.8, 3.2),
ylim = c((0.8 * min(clean_species_reduced[, traits_names[i]])),
(1.2 * max(clean_species_reduced[, traits_names[i]]))),
cex.lab = 1.3
)
}else{
plot(exp(clean_species_reduced[, traits_names[i]]) ~ I(as.numeric(clean_species_reduced$FG) + noise),
xlab = "",
ylab = traits_names_clean[i],
xaxt = 'n',
xlim = c(0.8, 3.2),
ylim = c((0.8 * min(exp(clean_species_reduced[, traits_names[i]]))),
(1.2 * max(exp(clean_species_reduced[, traits_names[i]])))),
cex.lab = 1.3
)
}
mtext(text = levels(clean_species_reduced$FG), side = 1, at = c(1,2,3), line = 1)
mtext(text = paste0("(", letters[i], ")") , side = 3, at = 0.4, line = .3)
(tuke <- TukeyHSD(aov(model)))
pvals <- tuke$`as.factor(clean_species_reduced$FG)`[, 4]
tuke_letters <- multcompLetters(pvals, reversed=TRUE)$Letters[c(3,1,2)]
ylim <- par("usr")[c(3,4)]
yrange <- ylim[2]-ylim[1]
text(x = c(1,2,3), y = ylim[2] - yrange/10, labels = tuke_letters, cex = 1.2)
}
dev.off()
#------------------------------------------------------------------------------
# What proportion of tree species sampled? For results section
#------------------------------------------------------------------------------
#calculate using both clean_species and clean_species_reduced
total_ba <- sum(plot_data$CSA_BH_expand, na.rm = TRUE)/10000
sampled_ba <- sum(plot_data[plot_data$Code %in% clean_species$Code, ]$CSA_BH_expand, na.rm = TRUE)/10000
sampled_ba/total_ba
plot_ba <- aggregate(plot_data[, c("P", "CSA_BH_expand")], by = list(plot_data$P), FUN = function(x){sum(x, na.rm=TRUE)})
sampled_plot_ba <- aggregate(plot_data[plot_data$Code %in% clean_species$Code, c("P", "CSA_BH_expand")],
by = list(plot_data[plot_data$Code %in% clean_species$Code, ]$P), FUN = function(x){sum(x, na.rm=TRUE)})
sampled_plot_ba$CSA_BH_expand / plot_ba$CSA_BH_expand
View(plot_data)
View(abund)
library("plyr")
trees_in_plots <- read.csv("./clean data/plot_data2018-01-24.csv")
species_counts <- read.csv(".\\raw data\\lista_spp_plantas_edited_sf082317.csv", stringsAsFactors=FALSE)
tab <- data.frame(table(trees_in_plots$Code))
names(tab)[1] <- "Code"
species_counts <- join(species_counts, tab, by = c("Code"))
species_counts$BA <- NA
for(i in 1:nrow(species_counts)){
species_counts$BA[i] <- sum(trees_in_plots[trees_in_plots$Code == species_counts$Code[i], ]$CSA_30_expand)
}
View(species_counts)
write.csv(species_counts)
write.csv(species_counts, "species_counts.csv")
View(plot_ba)
#-----------------------------------------------------------------------------------------
# Digging deeper in the light and fire data
#-----------------------------------------------------------------------------------------
#savanna plots
hist(plot_data$Light.code[plot_data$P %in% c(1, 3, 5, 7, 9, 11, 13, 15, 17, 19, 21, 23, 25:30)])
#forest plots
hist(plot_data$Light.code[plot_data$P %in% c(2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22, 24)])
hist(plot_data[!(plot_data$P %in% c(1,2, 9, 10, 17, 18)), ]$Char.height)
light_plot_data  <- plot_data[!is.na(plot_data$Light.code) & !is.na(plot_data$Char.height), ]
newdata <- data.frame(Light.code = seq(1, 5, length.out = 100))
#all burned plots
all_light_data <- light_plot_data[!(light_plot_data$P %in% c(1, 2, 9, 10, 17, 18)), ]
names(all_light_data)[2] <- "Plot"
plot(Char.height ~ Light.code, data = all_light_data)
light_char_lm <- lm(Char.height ~ poly(Light.code, 3), data = all_light_data)
summary(light_char_lm)
newdata$pred1 <- predict(light_char_lm, newdata = newdata)
lines(newdata$pred1 ~ newdata$Light.code)
#just cerradao burned plots
cerradao_light_data <- light_plot_data[light_plot_data$P %in% c(4, 6, 8, 12, 16, 20, 22, 24), ]
plot(Char.height ~ Light.code, data = cerradao_light_data)
light_char_lm <- lm(Char.height ~ poly(Light.code, 3), data = cerradao_light_data)
summary(light_char_lm)
newdata$pred2 <- predict(light_char_lm, newdata = newdata)
lines(newdata$pred2 ~ newdata$Light.code)
#just cerrado burned plots
cerrado_light_data <- light_plot_data[light_plot_data$P %in% c(3, 5, 7, 11, 13, 15, 19, 21, 23, 25:30), ]
plot(Char.height ~ Light.code, data = cerrado_light_data)
light_char_lm <- lm(Char.height ~ poly(Light.code, 3), data = cerrado_light_data)
summary(light_char_lm)
newdata$pred3 <- predict(light_char_lm, newdata = newdata)
lines(newdata$pred3 ~ newdata$Light.code)
### lm for light with interaction with BA
all_light_data <- join(all_light_data, plot_agg_traits[, c("Plot", "BA")], by = "Plot")
light_char_lm <- lm(log(Char.height+.1) ~ Light.code + BA, data = all_light_data)
library(plyr)
### lm for light with interaction with BA
all_light_data <- join(all_light_data, plot_agg_traits[, c("Plot", "BA")], by = "Plot")
light_char_lm <- lm(log(Char.height+.1) ~ Light.code + BA, data = all_light_data)
summary(light_char_lm)
plot(allEffects(light_char_lm, partial.residuals = TRUE))
library(effects)
plot(allEffects(light_char_lm, partial.residuals = TRUE))
library(earth)
ba_char_lm <- lm(Char.height ~ BA, data = all_light_data)
summary(ba_char_lm)
plot(Char.height ~ BA, data = all_light_data)
abline(coef(ba_char_lm))
ba_char_mars <- earth(Char.height ~ BA, data = all_light_data)
plot(ba_char_mars)
plot(Char.height ~ BA, data = all_light_data)
# abline(coef(ba_char_lm))
preds <- predict(ba_char_mars, newdata = data.frame("BA" = seq(0, 28, length.out = 200)))
lines(preds ~ seq(0, 28, length.out = 200), lwd = 2)
summary(ba_char_mars)
light_agg <- aggregate(all_light_data, by = list(all_light_data$Plot), FUN = mean)
light_se <- aggregate(all_light_data, by = list(all_light_data$Plot), FUN = sd)
plot(light_agg$Char.height ~ light_agg$BA)
arrows(x0 = light_agg$BA, y0 = light_agg$Char.height,
x1 = light_agg$BA, y1 = I(light_agg$Char.height + light_se$Char.height) )
plot(Char.height ~ BA, data = all_light_data)
# abline(coef(ba_char_lm))
preds <- predict(ba_char_mars, newdata = data.frame("BA" = seq(0, 28, length.out = 200)))
lines(preds ~ seq(0, 28, length.out = 200), lwd = 2)
points(light_agg$Char.height ~ light_agg$BA)
#Combined figure
plot(Char.height ~ BA, data = all_light_data,
ylim = c(0, 400),
xlab = expression(paste("Leaf size (cm"^"2", ")")))
#Combined figure
plot(Char.height ~ BA, data = all_light_data,
ylim = c(0, 400),
xlab = expression(paste("Leaf size (m"^"2", "ha"^"2", ")")))
#Combined figure
plot(Char.height ~ BA, data = all_light_data,
ylim = c(0, 400),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")))
# abline(coef(ba_char_lm))
preds <- predict(ba_char_mars, newdata = data.frame("BA" = seq(0, 28, length.out = 200)))
lines(preds ~ seq(0, 28, length.out = 200), lwd = 2)
#Combined figure
plot(Char.height ~ BA, data = all_light_data,
ylim = c(0, 400),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
pch = 21)
#Combined figure
plot(Char.height ~ BA, data = all_light_data,
ylim = c(0, 400),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
pch = 22)
#Combined figure
plot(Char.height ~ BA, data = all_light_data,
ylim = c(0, 400),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
pch = 21,
bg = "grey")
#Combined figure
plot(Char.height ~ BA, data = all_light_data,
ylim = c(0, 400),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
pch = 21,
bg = "grey",
cex.points = 0.5)
#Combined figure
plot(Char.height ~ BA, data = all_light_data,
ylim = c(0, 400),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
pch = 21,
bg = "grey",
cex = 0.5)
#Combined figure
plot(Char.height ~ BA, data = all_light_data,
ylim = c(0, 400),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
pch = 21,
bg = "grey",
cex = 0.7)
# abline(coef(ba_char_lm))
lines(preds ~ seq(0, 28, length.out = 200), lwd = 2)
points(light_agg$Char.height ~ light_agg$BA, pch = 23)
#Combined figure
plot(Char.height ~ BA, data = all_light_data,
ylim = c(0, 400),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
pch = 21,
bg = "grey",
cex = 0.7)
# abline(coef(ba_char_lm))
lines(preds ~ seq(0, 28, length.out = 200), lwd = 2)
points(light_agg$Char.height ~ light_agg$BA, pch = 23,
bg = "black",
cex = 1.3)
#*******************************************************************************************
# Classify species
#*******************************************************************************************
habitats <- as.vector(rep("S", times = 30))
?pch
#Combined figure
plot(Char.height ~ BA, data = all_light_data,
ylim = c(0, 400),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
pch = 21,
bg = "grey",
cex = 0.7)
# abline(coef(ba_char_lm))
lines(preds ~ seq(0, 28, length.out = 200), lwd = 2)
points(light_agg$Char.height ~ light_agg$BA, pch = 150,
bg = "black",
cex = 1.3)
#Combined figure
plot(Char.height ~ BA, data = all_light_data,
ylim = c(0, 400),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
pch = 21,
bg = "grey",
cex = 0.7)
# abline(coef(ba_char_lm))
lines(preds ~ seq(0, 28, length.out = 200), lwd = 2)
points(light_agg$Char.height ~ light_agg$BA, pch = 150,
bg = "black",
cex = 1.5)
#Combined figure
plot(Char.height ~ BA, data = all_light_data,
ylim = c(0, 4),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
ylab = "Char height (m)"
pch = 21,
bg = "grey",
cex = 0.7)
#Combined figure
plot(Char.height ~ BA, data = all_light_data,
ylim = c(0, 4),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
ylab = "Char height (m)",
pch = 21,
bg = "grey",
cex = 0.7)
# abline(coef(ba_char_lm))
lines(preds/100 ~ seq(0, 27.5, length.out = 200), lwd = 2)
points(light_agg$Char.height ~ light_agg$BA, pch = 150,
bg = "black",
cex = 1.5)
preds/100
#Combined figure
plot(Char.height/100 ~ BA, data = all_light_data,
ylim = c(0, 4),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
ylab = "Char height (m)",
pch = 21,
bg = "grey",
cex = 0.7)
# abline(coef(ba_char_lm))
lines(preds/100 ~ seq(0, 27.5, length.out = 200), lwd = 2)
points(light_agg$Char.height ~ light_agg$BA, pch = 150,
bg = "black",
cex = 1.5)
points(light_agg$Char.height/100 ~ light_agg$BA, pch = 150,
bg = "black",
cex = 1.5)
#Combined figure
plot(Char.height/100 ~ BA, data = all_light_data,
ylim = c(0, 4),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
ylab = "Char height (m)",
pch = 21,
bg = "grey",
cex = 0.7)
# abline(coef(ba_char_lm))
lines(preds/100 ~ seq(0, 27.5, length.out = 200), lwd = 2)
points(light_agg$Char.height/100 ~ light_agg$BA, pch = 150,
bg = "black",
cex = 1.5)
points(light_agg$Char.height/100 ~ light_agg$BA, pch = 150,
bg = "black",
col = "white"
cex = 1.5)
points(light_agg$Char.height/100 ~ light_agg$BA, pch = 150,
bg = "black",
col = "white",
cex = 1.5)
#Combined figure
plot(Char.height/100 ~ BA, data = all_light_data,
ylim = c(0, 4),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
ylab = "Char height (m)",
pch = 21,
bg = "grey",
col = "white",
cex = 0.7)
# abline(coef(ba_char_lm))
lines(preds/100 ~ seq(0, 27.5, length.out = 200), lwd = 2)
points(light_agg$Char.height/100 ~ light_agg$BA, pch = 150,
bg = "black",
cex = 1.5)
#Combined figure
plot(Char.height/100 ~ BA, data = all_light_data,
ylim = c(0, 4),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
ylab = "Char height (m)",
pch = 21,
bg = "grey",
cex = 0.7)
# abline(coef(ba_char_lm))
lines(preds/100 ~ seq(0, 27.5, length.out = 200), lwd = 2)
points(light_agg$Char.height/100 ~ light_agg$BA, pch = 150,
bg = "black",
cex = 1.5)
#Combined figure
col_map <- densCols(x = all_light_data$BA, y = all_light_data$Char.height, nbin = 128,
colramp = colorRampPalette(brewer.pal(9, "YlGnBu")[-c(1:2)], bias = 2))
#Combined figure
library(RColorBrewer)
col_map <- densCols(x = all_light_data$BA, y = all_light_data$Char.height, nbin = 128,
colramp = colorRampPalette(brewer.pal(9, "YlGnBu")[-c(1:2)], bias = 2))
plot(Char.height/100 ~ BA, data = all_light_data,
ylim = c(0, 4),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
ylab = "Char height (m)",
pch = 21,
cex = 0.7,
cols = col_map)
plot(Char.height/100 ~ BA, data = all_light_data,
ylim = c(0, 4),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
ylab = "Char height (m)",
pch = 21,
cex = 0.7,
col = col_map)
# abline(coef(ba_char_lm))
lines(preds/100 ~ seq(0, 27.5, length.out = 200), lwd = 2)
points(light_agg$Char.height/100 ~ light_agg$BA, pch = 150,
bg = "black",
cex = 1.5)
plot(Char.height/100 ~ BA, data = all_light_data,
ylim = c(0, 4),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
ylab = "Char height (m)",
pch = 21,
cex = 0.7,
bg = col_map,
col = col_map)
# abline(coef(ba_char_lm))
lines(preds/100 ~ seq(0, 27.5, length.out = 200), lwd = 2)
points(light_agg$Char.height/100 ~ light_agg$BA, pch = 150,
bg = "black",
cex = 1.5)
tiff(filename="./plots/char_height_BA.tiff",
type = "cairo",
antialias = "gray",
compression = "lzw",
units="in",
width = 5,
height=7,
pointsize=9,
res=600)
plot(Char.height/100 ~ BA, data = all_light_data,
ylim = c(0, 4),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
ylab = "Char height (m)",
pch = 21,
cex = 0.7,
bg = col_map,
col = col_map)
# abline(coef(ba_char_lm))
lines(preds/100 ~ seq(0, 27.5, length.out = 200), lwd = 2)
points(light_agg$Char.height/100 ~ light_agg$BA, pch = 150,
bg = "black",
cex = 1.5)
dev.off()
tiff(filename="./plots/char_height_BA.tiff",
type = "cairo",
antialias = "gray",
compression = "lzw",
units="in",
width = 5,
height=3,
pointsize=9,
res=600)
plot(Char.height/100 ~ BA, data = all_light_data,
ylim = c(0, 4),
xlab = expression(paste("Tree Basal Area (m"^"2", "ha"^"-1", ")")),
ylab = "Char height (m)",
pch = 21,
cex = 0.7,
bg = col_map,
col = col_map)
# abline(coef(ba_char_lm))
lines(preds/100 ~ seq(0, 27.5, length.out = 200), lwd = 2)
points(light_agg$Char.height/100 ~ light_agg$BA, pch = 150,
bg = "black",
cex = 1.5)
dev.off()
plot(ba_char_mars)
summary(ba_char_mars)
ba_char_mars <- earth(Char.height ~ BA, data = all_light_data)
plot(ba_char_mars)
summary(ba_char_mars)
library(earth)
ba_char_mars <- earth(Char.height ~ BA, data = all_light_data)
plot(ba_char_mars)
summary(ba_char_mars)
ba_char_lm <- lm(Char.height ~ BA, data = all_light_data)
summary(ba_char_lm)
AICc(ba_char_mars)
library(MuMIn)
AICc(ba_char_mars)
AICc(ba_char_mars)
plot(log(Char.height) ~ BA, data = all_light_data)
plot(Char.height ~ BA, data = all_light_data)
# abline(coef(ba_char_lm))
preds <- predict(ba_char_mars, newdata = data.frame("BA" = seq(0, 28, length.out = 200)))
lines(preds ~ seq(0, 28, length.out = 200), lwd = 2)
summary(ba_char_mars)
-2.8 + 3.04 - 2.7
?earth
model.matrix.earth(ba_char_mars)
model.matrix(ba_char_mars)
