col = c("black", "#1b9e77", "#E69F00"),
pt.bg = c("black", "#1b9e77", "#E69F00"),
pch = 21,
cex = 1.5,
bty = "n")
segments(x0 = 0, y0 = 0, x1 = trait_scores[, 1], y1 = trait_scores[, 2])
yoffsets <- c(0.05, -.05, .12, .05, -.06, .05, -.065, .05, -.08, -.065)
xoffsets <- c(-0.15, -.33, 0, 0.2, -.05, 0, -.25, -.3, .27, -.3)
text(x = trait_scores[, 1]+xoffsets, y = trait_scores[, 2]+yoffsets, labels = trait_names, cex = 1.3)
dev.off()
biplot(pca_results, choices = c(1,2))
trait_scores[, 1]
tiff(filename="./plots/Figure_3_traits_PCA_axes_1_2.tiff",
type = "cairo",
antialias = "gray",
compression = "lzw",
units="in",
width = 7,
height=7,
pointsize=9,
res=600)
color_groups <- data.frame(group = as.character(c("F", "G", "S")),
col = as.character(c("black", "#1b9e77", "#E69F00")))
color_points <- as.character(color_groups[match(pca_groups, color_groups$group), "col"])
plot(NA,
xlab = "PC1", ylab = "PC2",
xlim = c( (min(c(sp_scores[, 1], trait_scores[, 1]) - .5)),
(max(c(sp_scores[, 1], trait_scores[, 1])) + 0.4)),
ylim = c( (min(c(sp_scores[, 2], trait_scores[, 2]) - .5)),
(max(c(sp_scores[, 2], trait_scores[, 2])) + 0.4)))
abline(h = 0)
abline(v = 0)
x<-pointLabel(x = sp_scores[, 1], y = sp_scores[, 2], labels = pca_sp_names, col = color_points, cex = 0.7)
for(i in 1:3){
ordiellipse(pca_results, pca_groups, show.groups = color_groups[i, 1],
col = as.character(color_groups[i, 2]), choices = c(1,2),
kind = "sd", conf = 0.90)
}
legend(x = par()$usr[1], y = par()$usr[4],
legend = c("Forest", "Generalist", "Savanna"),
col = c("black", "#1b9e77", "#E69F00"),
pt.bg = c("black", "#1b9e77", "#E69F00"),
pch = 21,
cex = 1.5,
bty = "n")
segments(x0 = 0, y0 = 0, x1 = trait_scores[, 1], y1 = trait_scores[, 2])
yoffsets <- c(0.05, -.05, .12, .05, -.06, .05, -.065, .05, -.18, +.15)
xoffsets <- c(-0.15, -.33, 0, 0.2, -.05, 0, -.25, -.3, .27, -.3)
text(x = trait_scores[, 1]+xoffsets, y = trait_scores[, 2]+yoffsets, labels = trait_names, cex = 1.3)
dev.off()
yoffsets
trait_scores[, 1]
tiff(filename="./plots/Figure_3_traits_PCA_axes_1_2.tiff",
type = "cairo",
antialias = "gray",
compression = "lzw",
units="in",
width = 7,
height=7,
pointsize=9,
res=600)
color_groups <- data.frame(group = as.character(c("F", "G", "S")),
col = as.character(c("black", "#1b9e77", "#E69F00")))
color_points <- as.character(color_groups[match(pca_groups, color_groups$group), "col"])
plot(NA,
xlab = "PC1", ylab = "PC2",
xlim = c( (min(c(sp_scores[, 1], trait_scores[, 1]) - .5)),
(max(c(sp_scores[, 1], trait_scores[, 1])) + 0.4)),
ylim = c( (min(c(sp_scores[, 2], trait_scores[, 2]) - .5)),
(max(c(sp_scores[, 2], trait_scores[, 2])) + 0.4)))
abline(h = 0)
abline(v = 0)
x<-pointLabel(x = sp_scores[, 1], y = sp_scores[, 2], labels = pca_sp_names, col = color_points, cex = 0.7)
for(i in 1:3){
ordiellipse(pca_results, pca_groups, show.groups = color_groups[i, 1],
col = as.character(color_groups[i, 2]), choices = c(1,2),
kind = "sd", conf = 0.90)
}
legend(x = par()$usr[1], y = par()$usr[4],
legend = c("Forest", "Generalist", "Savanna"),
col = c("black", "#1b9e77", "#E69F00"),
pt.bg = c("black", "#1b9e77", "#E69F00"),
pch = 21,
cex = 1.5,
bty = "n")
segments(x0 = 0, y0 = 0, x1 = trait_scores[, 1], y1 = trait_scores[, 2])
yoffsets <- c(0.05, -.05, 0, .05, -.06, .05, -.065, .05, -.12, 0)
xoffsets <- c(-0.15, -.33, 0, 0.2, -.05, 0, -.25, -.3, .27, -.3)
text(x = trait_scores[, 1]+xoffsets, y = trait_scores[, 2]+yoffsets, labels = trait_names, cex = 1.3)
dev.off()
tiff(filename="./plots/Figure_3_traits_PCA_axes_1_2.tiff",
type = "cairo",
antialias = "gray",
compression = "lzw",
units="in",
width = 7,
height=7,
pointsize=9,
res=600)
color_groups <- data.frame(group = as.character(c("F", "G", "S")),
col = as.character(c("black", "#1b9e77", "#E69F00")))
color_points <- as.character(color_groups[match(pca_groups, color_groups$group), "col"])
plot(NA,
xlab = "PC1", ylab = "PC2",
xlim = c( (min(c(sp_scores[, 1], trait_scores[, 1]) - .5)),
(max(c(sp_scores[, 1], trait_scores[, 1])) + 0.4)),
ylim = c( (min(c(sp_scores[, 2], trait_scores[, 2]) - .5)),
(max(c(sp_scores[, 2], trait_scores[, 2])) + 0.4)))
abline(h = 0)
abline(v = 0)
x<-pointLabel(x = sp_scores[, 1], y = sp_scores[, 2], labels = pca_sp_names, col = color_points, cex = 0.7)
for(i in 1:3){
ordiellipse(pca_results, pca_groups, show.groups = color_groups[i, 1],
col = as.character(color_groups[i, 2]), choices = c(1,2),
kind = "sd", conf = 0.90)
}
legend(x = par()$usr[1], y = par()$usr[4],
legend = c("Forest", "Generalist", "Savanna"),
col = c("black", "#1b9e77", "#E69F00"),
pt.bg = c("black", "#1b9e77", "#E69F00"),
pch = 21,
cex = 1.5,
bty = "n")
segments(x0 = 0, y0 = 0, x1 = trait_scores[, 1], y1 = trait_scores[, 2])
yoffsets <- c(0.1, -.05, 0.03, .05, -.06, .05, -.065, .05, -.12, 0)
xoffsets <- c(-0.15, -.33, 0, 0.2, -.05, 0, -.25, -.3, .27, -.3)
text(x = trait_scores[, 1]+xoffsets, y = trait_scores[, 2]+yoffsets, labels = trait_names, cex = 1.3)
dev.off()
# setwd("C:\\Users\\Sam\\Google Drive\\Projects\\Savanna traits")
set.seed(45750765)
set.seed(45750766)
tiff(filename="./plots/Figure_3_traits_PCA_axes_1_2.tiff",
type = "cairo",
antialias = "gray",
compression = "lzw",
units="in",
width = 7,
height=7,
pointsize=9,
res=600)
color_groups <- data.frame(group = as.character(c("F", "G", "S")),
col = as.character(c("black", "#1b9e77", "#E69F00")))
color_points <- as.character(color_groups[match(pca_groups, color_groups$group), "col"])
plot(NA,
xlab = "PC1", ylab = "PC2",
xlim = c( (min(c(sp_scores[, 1], trait_scores[, 1]) - .5)),
(max(c(sp_scores[, 1], trait_scores[, 1])) + 0.4)),
ylim = c( (min(c(sp_scores[, 2], trait_scores[, 2]) - .5)),
(max(c(sp_scores[, 2], trait_scores[, 2])) + 0.4)))
abline(h = 0)
abline(v = 0)
x<-pointLabel(x = sp_scores[, 1], y = sp_scores[, 2], labels = pca_sp_names, col = color_points, cex = 0.7)
for(i in 1:3){
ordiellipse(pca_results, pca_groups, show.groups = color_groups[i, 1],
col = as.character(color_groups[i, 2]), choices = c(1,2),
kind = "sd", conf = 0.90)
}
legend(x = par()$usr[1], y = par()$usr[4],
legend = c("Forest", "Generalist", "Savanna"),
col = c("black", "#1b9e77", "#E69F00"),
pt.bg = c("black", "#1b9e77", "#E69F00"),
pch = 21,
cex = 1.5,
bty = "n")
segments(x0 = 0, y0 = 0, x1 = trait_scores[, 1], y1 = trait_scores[, 2])
yoffsets <- c(0.1, -.05, 0.03, .05, -.06, .05, -.065, .05, -.12, 0)
xoffsets <- c(-0.15, -.33, 0, 0.2, -.05, 0, -.25, -.3, .27, -.3)
text(x = trait_scores[, 1]+xoffsets, y = trait_scores[, 2]+yoffsets, labels = trait_names, cex = 1.3)
dev.off()
trait_scores[, 1]
tiff(filename="./plots/Figure_3_traits_PCA_axes_1_2.tiff",
type = "cairo",
antialias = "gray",
compression = "lzw",
units="in",
width = 7,
height=7,
pointsize=9,
res=600)
color_groups <- data.frame(group = as.character(c("F", "G", "S")),
col = as.character(c("black", "#1b9e77", "#E69F00")))
color_points <- as.character(color_groups[match(pca_groups, color_groups$group), "col"])
plot(NA,
xlab = "PC1", ylab = "PC2",
xlim = c( (min(c(sp_scores[, 1], trait_scores[, 1]) - .5)),
(max(c(sp_scores[, 1], trait_scores[, 1])) + 0.4)),
ylim = c( (min(c(sp_scores[, 2], trait_scores[, 2]) - .5)),
(max(c(sp_scores[, 2], trait_scores[, 2])) + 0.4)))
abline(h = 0)
abline(v = 0)
x<-pointLabel(x = sp_scores[, 1], y = sp_scores[, 2], labels = pca_sp_names, col = color_points, cex = 0.7)
for(i in 1:3){
ordiellipse(pca_results, pca_groups, show.groups = color_groups[i, 1],
col = as.character(color_groups[i, 2]), choices = c(1,2),
kind = "sd", conf = 0.90)
}
legend(x = par()$usr[1], y = par()$usr[4],
legend = c("Forest", "Generalist", "Savanna"),
col = c("black", "#1b9e77", "#E69F00"),
pt.bg = c("black", "#1b9e77", "#E69F00"),
pch = 21,
cex = 1.5,
bty = "n")
segments(x0 = 0, y0 = 0, x1 = trait_scores[, 1], y1 = trait_scores[, 2])
yoffsets <- c(0.12, -.05, 0.03, .05, -.06, .05, -.08, .05, -.15, 0.02)
xoffsets <- c(-0.15, -.33, 0, 0.2, -.05, 0, -.25, -.3, .27, -.3)
text(x = trait_scores[, 1]+xoffsets, y = trait_scores[, 2]+yoffsets, labels = trait_names, cex = 1.3)
dev.off()
set.seed(45750766)
tiff(filename="./plots/Figure_3_traits_PCA_axes_1_2.tiff",
type = "cairo",
antialias = "gray",
compression = "lzw",
units="in",
width = 7,
height=7,
pointsize=9,
res=600)
color_groups <- data.frame(group = as.character(c("F", "G", "S")),
col = as.character(c("black", "#1b9e77", "#E69F00")))
color_points <- as.character(color_groups[match(pca_groups, color_groups$group), "col"])
plot(NA,
xlab = "PC1", ylab = "PC2",
xlim = c( (min(c(sp_scores[, 1], trait_scores[, 1]) - .5)),
(max(c(sp_scores[, 1], trait_scores[, 1])) + 0.4)),
ylim = c( (min(c(sp_scores[, 2], trait_scores[, 2]) - .5)),
(max(c(sp_scores[, 2], trait_scores[, 2])) + 0.4)))
abline(h = 0)
abline(v = 0)
x<-pointLabel(x = sp_scores[, 1], y = sp_scores[, 2], labels = pca_sp_names, col = color_points, cex = 0.7)
for(i in 1:3){
ordiellipse(pca_results, pca_groups, show.groups = color_groups[i, 1],
col = as.character(color_groups[i, 2]), choices = c(1,2),
kind = "sd", conf = 0.90)
}
legend(x = par()$usr[1], y = par()$usr[4],
legend = c("Forest", "Generalist", "Savanna"),
col = c("black", "#1b9e77", "#E69F00"),
pt.bg = c("black", "#1b9e77", "#E69F00"),
pch = 21,
cex = 1.5,
bty = "n")
segments(x0 = 0, y0 = 0, x1 = trait_scores[, 1], y1 = trait_scores[, 2])
yoffsets <- c(0.12, -.05, 0.03, .05, -.06, .05, -.08, .05, -.15, 0.02)
xoffsets <- c(-0.15, -.33, 0, 0.2, -.05, 0, -.25, -.3, .27, -.3)
text(x = trait_scores[, 1]+xoffsets, y = trait_scores[, 2]+yoffsets, labels = trait_names, cex = 1.3)
dev.off()
tiff(filename="./plots/Figure_S2_traits_PCA_axes_1_3.tiff",
type = "cairo",
antialias = "gray",
compression = "lzw",
units="in",
width = 7,
height=7,
pointsize=9,
res=600)
color_groups <- data.frame(group = as.character(c("F", "G", "S")),
col = as.character(c("black", "#1b9e77", "#E69F00")))
color_points <- as.character(color_groups[match(pca_groups, color_groups$group), "col"])
plot(NA,
xlab = "PC1", ylab = "PC3",
xlim = c( (min(c(sp_scores[, 1], trait_scores[, 1]) - .5)),
(max(c(sp_scores[, 1], trait_scores[, 1])) + 0.4)),
ylim = c( (min(c(sp_scores[, 3], trait_scores[, 3]) - .5)),
(max(c(sp_scores[, 3], trait_scores[, 3])) + 0.4)),
yaxt = "n")
abline(h = 0)
abline(v = 0)
axis(2, las = 2)
pointLabel(x = sp_scores[, 1], y = sp_scores[, 3], labels = pca_sp_names, col = color_points, cex = 0.7)
for(i in 1:3){
ordiellipse(pca_results, pca_groups, show.groups = color_groups[i, 1],
col = as.character(color_groups[i, 2]), choices = c(1,3),
kind = "sd", conf = 0.90)
}
legend(x = par()$usr[1], y = par()$usr[4],
legend = c("Forest", "Generalist", "Savanna"),
col = c("black", "#1b9e77", "#E69F00"),
pt.bg = c("black", "#1b9e77", "#E69F00"),
pch = 21,
cex = 1.5,
bty = "n")
segments(x0 = 0, y0 = 0, x1 = trait_scores[, 1], y1 = trait_scores[, 3])
yoffsets <- c(0, -.05, -.05, 0, .05, 0, -.04, -.04, -.1, 0)
xoffsets <- c(0, 0, 0.23, 0, -.05, 0, -.25, -.25, 0, -0.2)
text(x = trait_scores[, 1]+xoffsets, y = trait_scores[, 3]+yoffsets, labels = trait_names, cex = 1.3)
dev.off()
summary(pca)
summary(results)
summary(pca_results)
# import data
leaf <- read.csv(".\\raw data\\leaf_traits.csv", stringsAsFactors = FALSE)
wood <- read.csv(".\\raw data\\twig_traits.csv", stringsAsFactors = FALSE)
field <- read.csv(".\\raw data\\field_data.csv", stringsAsFactors = FALSE)
sp_info <- read.csv(".\\raw data\\lista_spp_plantas_families_sf_2020_04_08.csv", stringsAsFactors = FALSE)
splink_class <- read.csv("./raw data/species_link_classification.csv", stringsAsFactors = FALSE)
plot_data <- read.csv("./raw data/30_parcelas_arvores_2015_complet_out_2015_sf_edits.csv", stringsAsFactors = FALSE)
charlight <- read.csv("./raw data/CharLight_final_102218.csv")
frost <- read.csv("./raw data/FrostDamageAll.csv")
max_heights <- read.csv("./raw data/species_max_heights.csv")
names(leaf)
names(field)
leaf_reduced <- leaf[!(leaf$Individual %in% c("Omit", "omit")), c("Individual", "Leaflet.or.leaf.size..mm2.", "Total.leaf.size..mm2.",
"Leaf.thickness.1..mm.", "Leaf.thickness.2..mm.", "Leaf.thickness.3..mm.", "SLA..cm2.g.1.", "Method")]
leaf_reduced$Leaf.thickness.1..mm. <- as.numeric(leaf_reduced$Leaf.thickness.1..mm.)
leaf_reduced$Leaf.thickness.2..mm. <- as.numeric(leaf_reduced$Leaf.thickness.2..mm.)
leaf_reduced$Leaf.thickness.3..mm. <- as.numeric(leaf_reduced$Leaf.thickness.3..mm.)
leaf_reduced$SLA..cm2.g.1. <- as.numeric(leaf_reduced$SLA..cm2.g.1.)
wood_reduced <- wood[!(wood$Individual %in% c("Omit", "omit")), c("Individual", "Outer.diameter", "Twig.bark.thickness", "Relative.bark.thickness", "Density..g.mL.")]
field_reduced <- field[!(field$Individual %in% c("Omit", "omit")), c("Individual", "X", "Code", "D30", "DBH", "Ht", "Lower.leaf", "Bark1", "Bark2", "Bark3", "Light", "Date")]
names(field_reduced)[2] <- "Bonus"
#get max DBH and max D30
#split diams at comma, then take the maximum
field_reduced$max_d30 <- vapply(strsplit(field_reduced$D30, split = ","),
1, FUN = function(x){return(as.numeric(max(unlist(x))))})
field_reduced$max_DBH <- vapply(strsplit(field_reduced$DBH, split = ","),
1, FUN = function(x){return(as.numeric(max(unlist(x))))})
field_reduced$D30_eff <- vapply(strsplit(field_reduced$D30, split = ","),
1, FUN = function(x){return(sqrt(sum(((as.numeric(unlist(x)))^2), na.rm = TRUE)))})
sp_info$Life.Form <- as.factor(tolower(sp_info$Life.Form))
#add specieslink classification
names(splink_class)[2] <- "New.name"
sp_info <- join(sp_info, splink_class[, c(2, 6, 7, 8)], by = c("New.name"))
write.csv(sp_info, "./raw data/sp_info_with_splink.csv")
# merge trait data
# from past sam: is there a more elegant way to do this than joinjoinjoinjoin?
# present sam: yes, it could use pipes
clean_data <- join(join(join(join(field_reduced, leaf_reduced, by = c("Individual"), type = "full"),
wood_reduced, by = c("Individual"), type = "full"),
sp_info, by = c("Code"), type = "left"),
max_heights[, c(2,3)], by = c("Code"), type = "left")
# Adding/calculating some variables
clean_data$Mean.Leaf.thickness <- NA
clean_data$Mean.Bark.thickness <- NA
clean_data$Crown.ratio <- NA
clean_data$Taper <- NA
clean_data$Inner.diam <- NA
clean_data$Stem.rel.bark.thick <- NA
for(i in 1:nrow(clean_data)){ #why is this all in a for loop? It seems like easily vectorized stuff
clean_data$Mean.Leaf.thickness[i] <- mean(unlist(clean_data[i, c("Leaf.thickness.1..mm.", "Leaf.thickness.2..mm.", "Leaf.thickness.3..mm.")]), na.rm=TRUE)
clean_data$Mean.Bark.thickness[i] <- mean(unlist(clean_data[i, c("Bark1", "Bark2", "Bark3")]), na.rm=TRUE)
clean_data$Crown.ratio[i] <- (clean_data$Ht[i] - clean_data$Lower.leaf[i]) / clean_data$Ht[i]
clean_data$Taper[i] <- clean_data$Ht[i] / clean_data$max_d30[i]
clean_data$Inner.diam[i] <- clean_data$max_d30[i] - clean_data$Mean.Bark.thickness[i]/5
clean_data$Stem.rel.bark.thick[i] <- (clean_data$Mean.Bark.thickness[i]/5)/ clean_data$max_d30[i]
}
clean_data$Ht <- clean_data$Ht/100
#Write data
write.csv(clean_data, ".\\clean data\\clean_data.csv")
leaf_reduced <- leaf[!(leaf$Individual %in% c("Omit", "omit")), c("Individual", "Leaflet.or.leaf.size..mm2.", "Total.leaf.size..mm2.",
"Leaf.thickness.1..mm.", "Leaf.thickness.2..mm.", "Leaf.thickness.3..mm.", "SLA..cm2.g.1.", "Method")]
leaf_reduced$Leaf.thickness.1..mm. <- as.numeric(leaf_reduced$Leaf.thickness.1..mm.)
leaf_reduced$Leaf.thickness.2..mm. <- as.numeric(leaf_reduced$Leaf.thickness.2..mm.)
leaf_reduced$Leaf.thickness.3..mm. <- as.numeric(leaf_reduced$Leaf.thickness.3..mm.)
leaf_reduced$SLA..cm2.g.1. <- as.numeric(leaf_reduced$SLA..cm2.g.1.)
wood_reduced <- wood[!(wood$Individual %in% c("Omit", "omit")), c("Individual", "Outer.diameter", "Twig.bark.thickness", "Relative.bark.thickness", "Density..g.mL.")]
field_reduced <- field[!(field$Individual %in% c("Omit", "omit")), c("Individual", "X", "Code", "D30", "DBH", "Ht", "Lower.leaf", "Bark1", "Bark2", "Bark3", "Light", "Date")]
names(field_reduced)[2] <- "Bonus"
#get max DBH and max D30
#split diams at comma, then take the maximum
field_reduced$max_d30 <- vapply(strsplit(field_reduced$D30, split = ","),
1, FUN = function(x){return(as.numeric(max(unlist(x))))})
field_reduced$max_DBH <- vapply(strsplit(field_reduced$DBH, split = ","),
1, FUN = function(x){return(as.numeric(max(unlist(x))))})
field_reduced$D30_eff <- vapply(strsplit(field_reduced$D30, split = ","),
1, FUN = function(x){return(sqrt(sum(((as.numeric(unlist(x)))^2), na.rm = TRUE)))})
sp_info$Life.Form <- as.factor(tolower(sp_info$Life.Form))
#add specieslink classification
names(splink_class)[2] <- "New.name"
sp_info <- join(sp_info, splink_class[, c(2, 6, 7, 8)], by = c("New.name"))
write.csv(sp_info, "./raw data/sp_info_with_splink.csv")
# merge trait data
# from past sam: is there a more elegant way to do this than joinjoinjoinjoin?
# present sam: yes, it could use pipes
clean_data <- join(join(join(join(field_reduced, leaf_reduced, by = c("Individual"), type = "full"),
wood_reduced, by = c("Individual"), type = "full"),
sp_info, by = c("Code"), type = "left"),
max_heights[, c(2,3)], by = c("Code"), type = "left")
# Adding/calculating some variables
clean_data$Mean.Leaf.thickness <- NA
clean_data$Mean.Bark.thickness <- NA
clean_data$Crown.ratio <- NA
clean_data$Taper <- NA
clean_data$Inner.diam <- NA
clean_data$Stem.rel.bark.thick <- NA
for(i in 1:nrow(clean_data)){ #why is this all in a for loop? It seems like easily vectorized stuff
clean_data$Mean.Leaf.thickness[i] <- mean(unlist(clean_data[i, c("Leaf.thickness.1..mm.", "Leaf.thickness.2..mm.", "Leaf.thickness.3..mm.")]), na.rm=TRUE)
clean_data$Mean.Bark.thickness[i] <- mean(unlist(clean_data[i, c("Bark1", "Bark2", "Bark3")]), na.rm=TRUE)
clean_data$Crown.ratio[i] <- (clean_data$Ht[i] - clean_data$Lower.leaf[i]) / clean_data$Ht[i]
clean_data$Taper[i] <- clean_data$Ht[i] / clean_data$max_d30[i]
clean_data$Inner.diam[i] <- clean_data$max_d30[i] - clean_data$Mean.Bark.thickness[i]/5
clean_data$Stem.rel.bark.thick[i] <- (clean_data$Mean.Bark.thickness[i]/5)/ clean_data$max_d30[i]
}
clean_data$Ht <- clean_data$Ht/100
#Write data
write.csv(clean_data, ".\\clean data\\clean_data.csv")
leaf_reduced <- leaf[!(leaf$Individual %in% c("Omit", "omit")), c("Individual", "Leaflet.or.leaf.size..mm2.", "Total.leaf.size..mm2.",
"Leaf.thickness.1..mm.", "Leaf.thickness.2..mm.", "Leaf.thickness.3..mm.", "SLA..cm2.g.1.", "Method")]
names(leaf_reduced)
# import data
leaf <- read.csv(".\\raw data\\leaf_traits.csv", stringsAsFactors = FALSE)
wood <- read.csv(".\\raw data\\twig_traits.csv", stringsAsFactors = FALSE)
field <- read.csv(".\\raw data\\field_data.csv", stringsAsFactors = FALSE)
sp_info <- read.csv(".\\raw data\\lista_spp_plantas_families_sf_2020_04_08.csv", stringsAsFactors = FALSE)
splink_class <- read.csv("./raw data/species_link_classification.csv", stringsAsFactors = FALSE)
plot_data <- read.csv("./raw data/30_parcelas_arvores_2015_complet_out_2015_sf_edits.csv", stringsAsFactors = FALSE)
charlight <- read.csv("./raw data/CharLight_final_102218.csv")
frost <- read.csv("./raw data/FrostDamageAll.csv")
max_heights <- read.csv("./raw data/species_max_heights.csv")
#------------------------------------------------------------------------------
# Clean up trait data
#------------------------------------------------------------------------------
# just pull in the pertinent data from each separate datasheet
leaf_reduced <- leaf[!(leaf$Individual %in% c("Omit", "omit")), c("Individual", "Leaflet.or.leaf.size..mm2.", "Total.leaf.size..mm2.",
"Leaf.thickness.1..mm.", "Leaf.thickness.2..mm.", "Leaf.thickness.3..mm.", "SLA..cm2.g.1.", "Method")]
leaf_reduced$Leaf.thickness.1..mm. <- as.numeric(leaf_reduced$Leaf.thickness.1..mm.)
leaf_reduced$Leaf.thickness.2..mm. <- as.numeric(leaf_reduced$Leaf.thickness.2..mm.)
leaf_reduced$Leaf.thickness.3..mm. <- as.numeric(leaf_reduced$Leaf.thickness.3..mm.)
leaf_reduced$SLA..cm2.g.1. <- as.numeric(leaf_reduced$SLA..cm2.g.1.)
wood_reduced <- wood[!(wood$Individual %in% c("Omit", "omit")), c("Individual", "Outer.diameter", "Twig.bark.thickness", "Relative.bark.thickness", "Density..g.mL.")]
field_reduced <- field[!(field$Individual %in% c("Omit", "omit")), c("Individual", "X", "Code", "D30", "DBH", "Ht", "Lower.leaf", "Bark1", "Bark2", "Bark3", "Light", "Date")]
names(field_reduced)[2] <- "Bonus"
#get max DBH and max D30
#split diams at comma, then take the maximum
field_reduced$max_d30 <- vapply(strsplit(field_reduced$D30, split = ","),
1, FUN = function(x){return(as.numeric(max(unlist(x))))})
field_reduced$max_DBH <- vapply(strsplit(field_reduced$DBH, split = ","),
1, FUN = function(x){return(as.numeric(max(unlist(x))))})
field_reduced$D30_eff <- vapply(strsplit(field_reduced$D30, split = ","),
1, FUN = function(x){return(sqrt(sum(((as.numeric(unlist(x)))^2), na.rm = TRUE)))})
sp_info$Life.Form <- as.factor(tolower(sp_info$Life.Form))
#add specieslink classification
names(splink_class)[2] <- "New.name"
sp_info <- join(sp_info, splink_class[, c(2, 6, 7, 8)], by = c("New.name"))
write.csv(sp_info, "./raw data/sp_info_with_splink.csv")
# merge trait data
# from past sam: is there a more elegant way to do this than joinjoinjoinjoin?
# present sam: yes, it could use pipes
clean_data <- join(join(join(join(field_reduced, leaf_reduced, by = c("Individual"), type = "full"),
wood_reduced, by = c("Individual"), type = "full"),
sp_info, by = c("Code"), type = "left"),
max_heights[, c(2,3)], by = c("Code"), type = "left")
# load libraries
library("plyr")
# TODO update to dplyr
library("effects")
library("lme4")
library("phytools")
library("ape")
source("./S.PhyloMaker-master/R_codes for S.PhyloMaker") #phylogeny tools
library("devtools")
# import data
leaf <- read.csv(".\\raw data\\leaf_traits.csv", stringsAsFactors = FALSE)
wood <- read.csv(".\\raw data\\twig_traits.csv", stringsAsFactors = FALSE)
field <- read.csv(".\\raw data\\field_data.csv", stringsAsFactors = FALSE)
sp_info <- read.csv(".\\raw data\\lista_spp_plantas_families_sf_2020_04_08.csv", stringsAsFactors = FALSE)
splink_class <- read.csv("./raw data/species_link_classification.csv", stringsAsFactors = FALSE)
plot_data <- read.csv("./raw data/30_parcelas_arvores_2015_complet_out_2015_sf_edits.csv", stringsAsFactors = FALSE)
charlight <- read.csv("./raw data/CharLight_final_102218.csv")
frost <- read.csv("./raw data/FrostDamageAll.csv")
max_heights <- read.csv("./raw data/species_max_heights.csv")
#------------------------------------------------------------------------------
# Clean up trait data
#------------------------------------------------------------------------------
# just pull in the pertinent data from each separate datasheet
leaf_reduced <- leaf[!(leaf$Individual %in% c("Omit", "omit")), c("Individual", "Leaflet.or.leaf.size..mm2.", "Total.leaf.size..mm2.",
"Leaf.thickness.1..mm.", "Leaf.thickness.2..mm.", "Leaf.thickness.3..mm.", "SLA..cm2.g.1.", "Method")]
leaf_reduced$Leaf.thickness.1..mm. <- as.numeric(leaf_reduced$Leaf.thickness.1..mm.)
leaf_reduced$Leaf.thickness.2..mm. <- as.numeric(leaf_reduced$Leaf.thickness.2..mm.)
leaf_reduced$Leaf.thickness.3..mm. <- as.numeric(leaf_reduced$Leaf.thickness.3..mm.)
leaf_reduced$SLA..cm2.g.1. <- as.numeric(leaf_reduced$SLA..cm2.g.1.)
wood_reduced <- wood[!(wood$Individual %in% c("Omit", "omit")), c("Individual", "Outer.diameter", "Twig.bark.thickness", "Relative.bark.thickness", "Density..g.mL.")]
field_reduced <- field[!(field$Individual %in% c("Omit", "omit")), c("Individual", "X", "Code", "D30", "DBH", "Ht", "Lower.leaf", "Bark1", "Bark2", "Bark3", "Light", "Date")]
names(field_reduced)[2] <- "Bonus"
#get max DBH and max D30
#split diams at comma, then take the maximum
field_reduced$max_d30 <- vapply(strsplit(field_reduced$D30, split = ","),
1, FUN = function(x){return(as.numeric(max(unlist(x))))})
field_reduced$max_DBH <- vapply(strsplit(field_reduced$DBH, split = ","),
1, FUN = function(x){return(as.numeric(max(unlist(x))))})
field_reduced$D30_eff <- vapply(strsplit(field_reduced$D30, split = ","),
1, FUN = function(x){return(sqrt(sum(((as.numeric(unlist(x)))^2), na.rm = TRUE)))})
sp_info$Life.Form <- as.factor(tolower(sp_info$Life.Form))
#add specieslink classification
names(splink_class)[2] <- "New.name"
sp_info <- join(sp_info, splink_class[, c(2, 6, 7, 8)], by = c("New.name"))
write.csv(sp_info, "./raw data/sp_info_with_splink.csv")
# merge trait data
# from past sam: is there a more elegant way to do this than joinjoinjoinjoin?
# present sam: yes, it could use pipes
clean_data <- join(join(join(join(field_reduced, leaf_reduced, by = c("Individual"), type = "full"),
wood_reduced, by = c("Individual"), type = "full"),
sp_info, by = c("Code"), type = "left"),
max_heights[, c(2,3)], by = c("Code"), type = "left")
# Adding/calculating some variables
clean_data$Mean.Leaf.thickness <- NA
clean_data$Mean.Bark.thickness <- NA
clean_data$Crown.ratio <- NA
clean_data$Taper <- NA
clean_data$Inner.diam <- NA
clean_data$Stem.rel.bark.thick <- NA
for(i in 1:nrow(clean_data)){ #why is this all in a for loop? It seems like easily vectorized stuff
clean_data$Mean.Leaf.thickness[i] <- mean(unlist(clean_data[i, c("Leaf.thickness.1..mm.", "Leaf.thickness.2..mm.", "Leaf.thickness.3..mm.")]), na.rm=TRUE)
clean_data$Mean.Bark.thickness[i] <- mean(unlist(clean_data[i, c("Bark1", "Bark2", "Bark3")]), na.rm=TRUE)
clean_data$Crown.ratio[i] <- (clean_data$Ht[i] - clean_data$Lower.leaf[i]) / clean_data$Ht[i]
clean_data$Taper[i] <- clean_data$Ht[i] / clean_data$max_d30[i]
clean_data$Inner.diam[i] <- clean_data$max_d30[i] - clean_data$Mean.Bark.thickness[i]/5
clean_data$Stem.rel.bark.thick[i] <- (clean_data$Mean.Bark.thickness[i]/5)/ clean_data$max_d30[i]
}
clean_data$Ht <- clean_data$Ht/100
#Write data
write.csv(clean_data, ".\\clean data\\clean_data.csv")
